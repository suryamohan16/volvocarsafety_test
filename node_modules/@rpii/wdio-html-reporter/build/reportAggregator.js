"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _htmlGenerator = _interopRequireDefault(require("./htmlGenerator"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const open = require('open');

let copyfiles = require("copyfiles");

const fs = require('fs-extra');

const path = require('path');

const moment = require('moment');

const logger = require('@log4js-node/log4js-api');

function walk(dir, extensions, filelist = []) {
  const files = fs.readdirSync(dir);
  files.forEach(function (file) {
    const filepath = path.join(dir, file);
    const stat = fs.statSync(filepath);

    if (stat.isDirectory()) {
      filelist = walk(filepath, extensions, filelist);
    } else {
      extensions.forEach(function (extension) {
        if (file.indexOf(extension) == file.length - extension.length) {
          filelist.push(filepath);
        }
      });
    }
  });
  return filelist;
}

class ReportAggregator {
  constructor(opts) {
    opts = Object.assign({}, {
      outputDir: 'reports/html-reports/',
      filename: 'master-report.html',
      reportTitle: 'Test Master Report',
      showInBrowser: false,
      templateFilename: path.resolve(__dirname, '../templates/wdio-html-reporter-template.hbs'),
      templateFuncs: {},
      browserName: "not specified",
      LOG: null
    }, opts);
    this.options = opts;

    if (!this.options.LOG) {
      this.options.LOG = logger.getLogger("default");
    }

    this.options.reportFile = path.join(process.cwd(), this.options.outputDir, this.options.filename);
    this.reports = [];
  }

  clean() {
    fs.emptyDirSync(this.options.outputDir);
  }

  readJsonFiles() {
    return walk(this.options.outputDir, [".json"]);
  }

  log(message, object) {
    if (this.options.LOG) {
      this.options.LOG.debug(message + object);
    }
  }

  async createReport() {
    if (this.options.LOG) {
      this.options.LOG.debug("Report Aggregation started");
    }

    let metrics = {
      passed: 0,
      skipped: 0,
      failed: 0,
      start: new moment(),
      end: new moment(),
      duration: 0
    };
    let suites = [];
    let specs = [];
    let files = this.readJsonFiles();

    for (let i = 0; i < files.length; i++) {
      try {
        let filename = files[i];
        let report = JSON.parse(fs.readFileSync(filename));

        if (!report.info || !report.info.specs) {
          this.options.LOG.error("report structure in question, no info or info.specs ", JSON.stringify(report));
          this.options.LOG.info("report content: ", JSON.stringify(report));
        }

        report.info.specs.forEach(spec => {
          specs.push(spec);
        });
        this.reports.push(report);
        metrics.passed += report.metrics.passed;
        metrics.failed += report.metrics.failed;
        metrics.skipped += report.metrics.skipped;

        for (let k = 0; k < report.suites.length; k++) {
          let suite = report.suites[k];
          let start = moment.utc(suite.start);

          if (start.isSameOrBefore(metrics.start)) {
            metrics.start = start;
          }

          let end = moment.utc(suite.end);

          if (end.isAfter(metrics.end)) {
            metrics.end = end;
          }

          suites.push(suite);
        }
      } catch (ex) {
        console.error(ex);
      }
    }

    if (!this.reports || !this.reports.length) {
      // the test failed hard at the beginning.  Create a dummy structure to get through html generation
      let report = {
        "info": {
          "cid": "The execution of the test suite has failed before report generation was started.  Please look at the logs to determine the error, this is likely an issue with your configuration files.",
          "config": {
            "hostname": "localhost"
          },
          "specs": [],
          "suites": [{
            "uid": "Test Start Failure",
            "title": "Test Start Failure",
            "type": "suite",
            "tests": []
          }]
        }
      };
      this.reports = [];
      this.reports.push(report);
    }

    let duration = metrics.end.diff(metrics.start);
    metrics.duration = moment.duration(duration, "milliseconds").format('hh:mm:ss.SS', {
      trim: false
    });
    metrics.start = metrics.start.format();
    metrics.end = metrics.end.format();
    const reportOptions = {
      data: {
        info: this.reports[0].info,
        specs: specs,
        metrics: metrics,
        suites: suites,
        title: this.options.reportTitle,
        browserName: this.options.browserName
      },
      outputDir: this.options.outputDir,
      reportFile: this.options.reportFile,
      templateFilename: this.options.templateFilename,
      LOG: this.options.LOG,
      templateFuncs: this.options.templateFuncs,
      showInBrowser: this.options.showInBrowser,
      collapseTests: this.options.collapseTests
    };

    if (this.options.LOG) {
      this.options.LOG.debug("Aggregated " + specs.length + " specs, " + suites.length + " suites, " + this.reports.length + " reports, ");
    }

    _htmlGenerator.default.htmlOutput(reportOptions);

    reportOptions.LOG.debug("Report Aggregation completed");
    let jsFiles = path.join(__dirname, '../js/*.*');
    let reportDir = path.join(process.cwd(), this.options.outputDir);
    copyfiles([jsFiles, reportDir], true, () => {
      reportOptions.LOG.info('copyfiles complete : ' + jsFiles + " to " + reportDir);

      try {
        if (this.options.showInBrowser) {
          let childProcess = open(this.options.reportFile);
          childProcess.then(() => {
            reportOptions.LOG.info('browser launched');
          }, error => {
            reportOptions.LOG.error('showInBrowser error spawning :' + this.options.reportFile + " " + error.toString());
          });
        }
      } catch (ex) {
        reportOptions.LOG.error('Error opening browser:' + ex);
      }
    });
  }

}

var _default = ReportAggregator;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXBvcnRBZ2dyZWdhdG9yLmpzIl0sIm5hbWVzIjpbIm9wZW4iLCJyZXF1aXJlIiwiY29weWZpbGVzIiwiZnMiLCJwYXRoIiwibW9tZW50IiwibG9nZ2VyIiwid2FsayIsImRpciIsImV4dGVuc2lvbnMiLCJmaWxlbGlzdCIsImZpbGVzIiwicmVhZGRpclN5bmMiLCJmb3JFYWNoIiwiZmlsZSIsImZpbGVwYXRoIiwiam9pbiIsInN0YXQiLCJzdGF0U3luYyIsImlzRGlyZWN0b3J5IiwiZXh0ZW5zaW9uIiwiaW5kZXhPZiIsImxlbmd0aCIsInB1c2giLCJSZXBvcnRBZ2dyZWdhdG9yIiwiY29uc3RydWN0b3IiLCJvcHRzIiwiT2JqZWN0IiwiYXNzaWduIiwib3V0cHV0RGlyIiwiZmlsZW5hbWUiLCJyZXBvcnRUaXRsZSIsInNob3dJbkJyb3dzZXIiLCJ0ZW1wbGF0ZUZpbGVuYW1lIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInRlbXBsYXRlRnVuY3MiLCJicm93c2VyTmFtZSIsIkxPRyIsIm9wdGlvbnMiLCJnZXRMb2dnZXIiLCJyZXBvcnRGaWxlIiwicHJvY2VzcyIsImN3ZCIsInJlcG9ydHMiLCJjbGVhbiIsImVtcHR5RGlyU3luYyIsInJlYWRKc29uRmlsZXMiLCJsb2ciLCJtZXNzYWdlIiwib2JqZWN0IiwiZGVidWciLCJjcmVhdGVSZXBvcnQiLCJtZXRyaWNzIiwicGFzc2VkIiwic2tpcHBlZCIsImZhaWxlZCIsInN0YXJ0IiwiZW5kIiwiZHVyYXRpb24iLCJzdWl0ZXMiLCJzcGVjcyIsImkiLCJyZXBvcnQiLCJKU09OIiwicGFyc2UiLCJyZWFkRmlsZVN5bmMiLCJpbmZvIiwiZXJyb3IiLCJzdHJpbmdpZnkiLCJzcGVjIiwiayIsInN1aXRlIiwidXRjIiwiaXNTYW1lT3JCZWZvcmUiLCJpc0FmdGVyIiwiZXgiLCJjb25zb2xlIiwiZGlmZiIsImZvcm1hdCIsInRyaW0iLCJyZXBvcnRPcHRpb25zIiwiZGF0YSIsInRpdGxlIiwiY29sbGFwc2VUZXN0cyIsIkh0bWxHZW5lcmF0b3IiLCJodG1sT3V0cHV0IiwianNGaWxlcyIsInJlcG9ydERpciIsImNoaWxkUHJvY2VzcyIsInRoZW4iLCJ0b1N0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7QUFDQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLElBQUlDLFNBQVMsR0FBR0QsT0FBTyxDQUFDLFdBQUQsQ0FBdkI7O0FBRUEsTUFBTUUsRUFBRSxHQUFHRixPQUFPLENBQUMsVUFBRCxDQUFsQjs7QUFDQSxNQUFNRyxJQUFJLEdBQUdILE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1JLE1BQU0sR0FBR0osT0FBTyxDQUFDLFFBQUQsQ0FBdEI7O0FBQ0EsTUFBTUssTUFBTSxHQUFHTCxPQUFPLENBQUMseUJBQUQsQ0FBdEI7O0FBRUEsU0FBVU0sSUFBVixDQUFlQyxHQUFmLEVBQW9CQyxVQUFwQixFQUFpQ0MsUUFBUSxHQUFHLEVBQTVDLEVBQWdEO0FBQzVDLFFBQU1DLEtBQUssR0FBR1IsRUFBRSxDQUFDUyxXQUFILENBQWVKLEdBQWYsQ0FBZDtBQUVBRyxFQUFBQSxLQUFLLENBQUNFLE9BQU4sQ0FBYyxVQUFVQyxJQUFWLEVBQWdCO0FBQzFCLFVBQU1DLFFBQVEsR0FBR1gsSUFBSSxDQUFDWSxJQUFMLENBQVVSLEdBQVYsRUFBZU0sSUFBZixDQUFqQjtBQUNBLFVBQU1HLElBQUksR0FBR2QsRUFBRSxDQUFDZSxRQUFILENBQVlILFFBQVosQ0FBYjs7QUFFQSxRQUFJRSxJQUFJLENBQUNFLFdBQUwsRUFBSixFQUF3QjtBQUNwQlQsTUFBQUEsUUFBUSxHQUFHSCxJQUFJLENBQUNRLFFBQUQsRUFBV04sVUFBWCxFQUF1QkMsUUFBdkIsQ0FBZjtBQUNILEtBRkQsTUFFTztBQUNIRCxNQUFBQSxVQUFVLENBQUNJLE9BQVgsQ0FBbUIsVUFBVU8sU0FBVixFQUFxQjtBQUNwQyxZQUFJTixJQUFJLENBQUNPLE9BQUwsQ0FBYUQsU0FBYixLQUEy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LEtBQWxCLENBQXdCLG1DQUFtQyxLQUFLN0IsT0FBTCxDQUFhRSxVQUFoRCxHQUE2RCxHQUE3RCxHQUFtRTJCLEtBQUssQ0FBQ3VCLFFBQU4sRUFBM0Y7QUFDSCxXQU5MO0FBT0g7QUFDSixPQVpELENBWUUsT0FBT2YsRUFBUCxFQUFXO0FBQ1RLLFFBQUFBLGFBQWEsQ0FBQzNDLEdBQWQsQ0FBa0I4QixLQUFsQixDQUF3QiwyQkFBMkJRLEVBQW5EO0FBQ0g7QUFDSixLQWxCSSxDQUFUO0FBcUJIOztBQW5La0I7O2VBd0tScEQsZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSHRtbEdlbmVyYXRvciBmcm9tIFwiLi9odG1sR2VuZXJhdG9yXCI7XHJcbmNvbnN0IG9wZW4gPSByZXF1aXJlKCdvcGVuJyk7XHJcbmxldCBjb3B5ZmlsZXMgPSByZXF1aXJlKFwiY29weWZpbGVzXCIpO1xyXG5cclxuY29uc3QgZnMgPSByZXF1aXJlKCdmcy1leHRyYScpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xyXG5jb25zdCBtb21lbnQgPSByZXF1aXJlKCdtb21lbnQnKTtcclxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnQGxvZzRqcy1ub2RlL2xvZzRqcy1hcGknKTtcclxuXHJcbmZ1bmN0aW9uICB3YWxrKGRpciwgZXh0ZW5zaW9ucyAsIGZpbGVsaXN0ID0gW10pIHtcclxuICAgIGNvbnN0IGZpbGVzID0gZnMucmVhZGRpclN5bmMoZGlyKTtcclxuXHJcbiAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlKSB7XHJcbiAgICAgICAgY29uc3QgZmlsZXBhdGggPSBwYXRoLmpvaW4oZGlyLCBmaWxlKTtcclxuICAgICAgICBjb25zdCBzdGF0ID0gZnMuc3RhdFN5bmMoZmlsZXBhdGgpO1xyXG5cclxuICAgICAgICBpZiAoc3RhdC5pc0RpcmVjdG9yeSgpKSB7XHJcbiAgICAgICAgICAgIGZpbGVsaXN0ID0gd2FsayhmaWxlcGF0aCwgZXh0ZW5zaW9ucywgZmlsZWxpc3QpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGV4dGVuc2lvbnMuZm9yRWFjaChmdW5jdGlvbiAoZXh0ZW5zaW9uKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsZS5pbmRleE9mKGV4dGVuc2lvbikgPT0gZmlsZS5sZW5ndGggLSBleHRlbnNpb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZWxpc3QucHVzaChmaWxlcGF0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBmaWxlbGlzdDtcclxufVxyXG5cclxuY2xhc3MgUmVwb3J0QWdncmVnYXRvciB7XHJcblxyXG4gICAgY29uc3RydWN0b3Iob3B0cykge1xyXG4gICAgICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCB7XHJcbiAgICAgICAgICAgIG91dHB1dERpcjogJ3JlcG9ydHMvaHRtbC1yZXBvcnRzLycsXHJcbiAgICAgICAgICAgIGZpbGVuYW1lOiAnbWFzdGVyLXJlcG9ydC5odG1sJyxcclxuICAgICAgICAgICAgcmVwb3J0VGl0bGU6ICdUZXN0IE1hc3RlciBSZXBvcnQnLFxyXG4gICAgICAgICAgICBzaG93SW5Ccm93c2VyOiBmYWxzZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVGaWxlbmFtZTogcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uL3RlbXBsYXRlcy93ZGlvLWh0bWwtcmVwb3J0ZXItdGVtcGxhdGUuaGJzJyksXHJcbiAgICAgICAgICAgIHRlbXBsYXRlRnVuY3M6IHt9LFxyXG4gICAgICAgICAgICBicm93c2VyTmFtZTogXCJub3Qgc3BlY2lmaWVkXCIsXHJcbiAgICAgICAgICAgIExPRzogbnVsbFxyXG4gICAgICAgIH0sIG9wdHMpO1xyXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdHM7XHJcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuTE9HKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5MT0cgPSBsb2dnZXIuZ2V0TG9nZ2VyKFwiZGVmYXVsdFwiKSAgICAgIDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vcHRpb25zLnJlcG9ydEZpbGUgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgdGhpcy5vcHRpb25zLm91dHB1dERpciwgdGhpcy5vcHRpb25zLmZpbGVuYW1lKTtcclxuICAgICAgICB0aGlzLnJlcG9ydHMgPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhbigpIHtcclxuICAgICAgICBmcy5lbXB0eURpclN5bmModGhpcy5vcHRpb25zLm91dHB1dERpcik7XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICByZWFkSnNvbkZpbGVzKCkge1xyXG4gICAgICAgIHJldHVybiB3YWxrKHRoaXMub3B0aW9ucy5vdXRwdXREaXIsIFtcIi5qc29uXCJdKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgbG9nKG1lc3NhZ2Usb2JqZWN0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5MT0cpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLkxPRy5kZWJ1ZyhtZXNzYWdlICsgb2JqZWN0KSA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYXN5bmMgY3JlYXRlUmVwb3J0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuTE9HKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5MT0cuZGVidWcoXCJSZXBvcnQgQWdncmVnYXRpb24gc3RhcnRlZFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IG1ldHJpY3MgPSB7XHJcbiAgICAgICAgICAgIHBhc3NlZDogMCxcclxuICAgICAgICAgICAgc2tpcHBlZDogMCxcclxuICAgICAgICAgICAgZmFpbGVkOiAwLFxyXG4gICAgICAgICAgICBzdGFydCA6IG5ldyBtb21lbnQoKSxcclxuICAgICAgICAgICAgZW5kIDogbmV3IG1vbWVudCgpLFxyXG4gICAgICAgICAgICBkdXJhdGlvbjogMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgbGV0IHN1aXRlcyA9IFtdO1xyXG4gICAgICAgIGxldCBzcGVjcyA9IFtdO1xyXG5cclxuICAgICAgICBsZXQgZmlsZXMgPSB0aGlzLnJlYWRKc29uRmlsZXMoKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGZpbGVuYW1lID0gZmlsZXNbaV07XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVwb3J0ID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoZmlsZW5hbWUpKTtcclxuICAgICAgICAgICAgICAgIGlmICghcmVwb3J0LmluZm8gfHwgIXJlcG9ydC5pbmZvLnNwZWNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLkxPRy5lcnJvcihcInJlcG9ydCBzdHJ1Y3R1cmUgaW4gcXVlc3Rpb24sIG5vIGluZm8gb3IgaW5mby5zcGVjcyBcIiAsIEpTT04uc3RyaW5naWZ5KHJlcG9ydCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5MT0cuaW5mbyhcInJlcG9ydCBjb250ZW50OiBcIiAsIEpTT04uc3RyaW5naWZ5KHJlcG9ydCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVwb3J0LmluZm8uc3BlY3MuZm9yRWFjaCgoc3BlYykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNwZWNzLnB1c2goc3BlYykgO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMucmVwb3J0cy5wdXNoKHJlcG9ydCk7XHJcbiAgICAgICAgICAgICAgICBtZXRyaWNzLnBhc3NlZCArPSByZXBvcnQubWV0cmljcy5wYXNzZWQ7XHJcbiAgICAgICAgICAgICAgICBtZXRyaWNzLmZhaWxlZCArPSByZXBvcnQubWV0cmljcy5mYWlsZWQ7XHJcbiAgICAgICAgICAgICAgICBtZXRyaWNzLnNraXBwZWQgKz0gcmVwb3J0Lm1ldHJpY3Muc2tpcHBlZDtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IHJlcG9ydC5zdWl0ZXMubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgc3VpdGUgPSByZXBvcnQuc3VpdGVzW2tdIDtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgc3RhcnQgPSBtb21lbnQudXRjKHN1aXRlLnN0YXJ0KSA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBzdGFydC5pc1NhbWVPckJlZm9yZShtZXRyaWNzLnN0YXJ0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWNzLnN0YXJ0ID0gIHN0YXJ0IDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVuZCA9IG1vbWVudC51dGMoc3VpdGUuZW5kKSA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBlbmQuaXNBZnRlcihtZXRyaWNzLmVuZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljcy5lbmQgPSAgZW5kIDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgc3VpdGVzLnB1c2goc3VpdGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihleCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5yZXBvcnRzIHx8ICF0aGlzLnJlcG9ydHMubGVuZ3RoICkge1xyXG4gICAgICAgICAgICAvLyB0aGUgdGVzdCBmYWlsZWQgaGFyZCBhdCB0aGUgYmVnaW5uaW5nLiAgQ3JlYXRlIGEgZHVtbXkgc3RydWN0dXJlIHRvIGdldCB0aHJvdWdoIGh0bWwgZ2VuZXJhdGlvblxyXG4gICAgICAgICAgICBsZXQgcmVwb3J0ID0ge1xyXG4gICAgICAgICAgICAgICAgXCJpbmZvXCIgOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJjaWRcIjogXCJUaGUgZXhlY3V0aW9uIG9mIHRoZSB0ZXN0IHN1aXRlIGhhcyBmYWlsZWQgYmVmb3JlIHJlcG9ydCBnZW5lcmF0aW9uIHdhcyBzdGFydGVkLiAgUGxlYXNlIGxvb2sgYXQgdGhlIGxvZ3MgdG8gZGV0ZXJtaW5lIHRoZSBlcnJvciwgdGhpcyBpcyBsaWtlbHkgYW4gaXNzdWUgd2l0aCB5b3VyIGNvbmZpZ3VyYXRpb24gZmlsZXMuXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJjb25maWdcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImhvc3RuYW1lXCI6IFwibG9jYWxob3N0XCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgXCJzcGVjc1wiOiBbXSxcclxuICAgICAgICAgICAgICAgIFwic3VpdGVzXCI6IFtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidWlkXCI6IFwiVGVzdCBTdGFydCBGYWlsdXJlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGl0bGVcIjogXCJUZXN0IFN0YXJ0IEZhaWx1cmVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwic3VpdGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0ZXN0c1wiOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLnJlcG9ydHMgPSBbXSA7XHJcbiAgICAgICAgICAgIHRoaXMucmVwb3J0cy5wdXNoKHJlcG9ydCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgZHVyYXRpb24gPSBtZXRyaWNzLmVuZC5kaWZmKG1ldHJpY3Muc3RhcnQpIDtcclxuICAgICAgICBtZXRyaWNzLmR1cmF0aW9uID0gbW9tZW50LmR1cmF0aW9uKGR1cmF0aW9uLCBcIm1pbGxpc2Vjb25kc1wiKS5mb3JtYXQoJ2hoOm1tOnNzLlNTJywge3RyaW06IGZhbHNlfSk7XHJcbiAgICAgICAgbWV0cmljcy5zdGFydCA9IG1ldHJpY3Muc3RhcnQuZm9ybWF0KCkgO1xyXG4gICAgICAgIG1ldHJpY3MuZW5kID0gbWV0cmljcy5lbmQuZm9ybWF0KCkgO1xyXG5cclxuICAgICAgICBjb25zdCByZXBvcnRPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBpbmZvOiB0aGlzLnJlcG9ydHNbMF0uaW5mbyxcclxuICAgICAgICAgICAgICAgIHNwZWNzOnNwZWNzLFxyXG4gICAgICAgICAgICAgICAgbWV0cmljczogbWV0cmljcyxcclxuICAgICAgICAgICAgICAgIHN1aXRlczogc3VpdGVzLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMub3B0aW9ucy5yZXBvcnRUaXRsZSxcclxuICAgICAgICAgICAgICAgIGJyb3dzZXJOYW1lOiB0aGlzLm9wdGlvbnMuYnJvd3Nlck5hbWVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb3V0cHV0RGlyOiB0aGlzLm9wdGlvbnMub3V0cHV0RGlyLFxyXG4gICAgICAgICAgICByZXBvcnRGaWxlOiB0aGlzLm9wdGlvbnMucmVwb3J0RmlsZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVGaWxlbmFtZTogdGhpcy5vcHRpb25zLnRlbXBsYXRlRmlsZW5hbWUsXHJcbiAgICAgICAgICAgIExPRyA6IHRoaXMub3B0aW9ucy5MT0csXHJcbiAgICAgICAgICAgIHRlbXBsYXRlRnVuY3M6IHRoaXMub3B0aW9ucy50ZW1wbGF0ZUZ1bmNzLFxyXG4gICAgICAgICAgICBzaG93SW5Ccm93c2VyOiB0aGlzLm9wdGlvbnMuc2hvd0luQnJvd3NlcixcclxuICAgICAgICAgICAgY29sbGFwc2VUZXN0czogdGhpcy5vcHRpb25zLmNvbGxhcHNlVGVzdHNcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLkxPRykge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuTE9HLmRlYnVnKFwiQWdncmVnYXRlZCBcIiArIHNwZWNzLmxlbmd0aCArIFwiIHNwZWNzLCBcIiArIHN1aXRlcy5sZW5ndGggKyBcIiBzdWl0ZXMsIFwiICsgdGhpcy5yZXBvcnRzLmxlbmd0aCArIFwiIHJlcG9ydHMsIFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgSHRtbEdlbmVyYXRvci5odG1sT3V0cHV0KHJlcG9ydE9wdGlvbnMpO1xyXG4gICAgICAgIHJlcG9ydE9wdGlvbnMuTE9HLmRlYnVnKFwiUmVwb3J0IEFnZ3JlZ2F0aW9uIGNvbXBsZXRlZFwiKTtcclxuICAgICAgICBsZXQganNGaWxlcyA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9qcy8qLionKTtcclxuICAgICAgICBsZXQgcmVwb3J0RGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIHRoaXMub3B0aW9ucy5vdXRwdXREaXIpO1xyXG4gICAgICAgIGNvcHlmaWxlcyggW2pzRmlsZXMsIHJlcG9ydERpcl0gLCB0cnVlLFxyXG4gICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXBvcnRPcHRpb25zLkxPRy5pbmZvKCAnY29weWZpbGVzIGNvbXBsZXRlIDogJyArIGpzRmlsZXMgICsgXCIgdG8gXCIgKyByZXBvcnREaXIpIDtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zaG93SW5Ccm93c2VyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2hpbGRQcm9jZXNzID0gb3Blbih0aGlzLm9wdGlvbnMucmVwb3J0RmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkUHJvY2Vzcy50aGVuKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydE9wdGlvbnMuTE9HLmluZm8oJ2Jyb3dzZXIgbGF1bmNoZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnRPcHRpb25zLkxPRy5lcnJvcignc2hvd0luQnJvd3NlciBlcnJvciBzcGF3bmluZyA6JyArIHRoaXMub3B0aW9ucy5yZXBvcnRGaWxlICsgXCIgXCIgKyBlcnJvci50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXBvcnRPcHRpb25zLkxPRy5lcnJvcignRXJyb3Igb3BlbmluZyBicm93c2VyOicgKyBleCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApXHJcblxyXG4gICAgfVxyXG5cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJlcG9ydEFnZ3JlZ2F0b3I7XHJcbiJdfQ==